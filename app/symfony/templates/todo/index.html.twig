{% extends 'base.html.twig' %}

{% block title %}Todo List{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .todo-list {
            max-width: 600px;
            margin: 0 auto;
        }
        .todo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 5px;
            background-color: #f5f5f5;
        }
        .todo-done {
            background-color: #d1e7dd;
            text-decoration: line-through;
        }
        .todo-title {
            flex-grow: 1;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h1 class="text-center mb-4">Todo List</h1>

        <div class="todo-list" id="todo-container">
            <!-- Les todos seront chargÃ©s ici via JavaScript -->
            <div class="text-center">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/todos')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('todo-container');
                    container.innerHTML = '';

                    if (data.length === 0) {
                        container.innerHTML = '<p class="text-center">No todos found.</p>';
                        return;
                    }

                    data.forEach(todo => {
                        const todoItem = document.createElement('div');
                        todoItem.className = `todo-item ${todo.done ? 'todo-done' : ''}`;

                        todoItem.innerHTML = `
                            <div class="todo-title">${todo.title}</div>
                            <div class="todo-status">
                                <span class="badge ${todo.done ? 'bg-success' : 'bg-warning'}">
                                    ${todo.done ? 'Done' : 'Pending'}
                                </span>
                            </div>
                        `;

                        container.appendChild(todoItem);
                    });
                })
                .catch(error => {
                    console.error('Error fetching todos:', error);
                    const container = document.getElementById('todo-container');
                    container.innerHTML = '<p class="text-center text-danger">Error loading todos.</p>';
                });
        });
    </script>
{% endblock %}
